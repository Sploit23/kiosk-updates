<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Kiosk de Fotos</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        height: 100vh;
        background: #f0f0f0;
    }
    /* Sidebar */
    #sidebar {
        width: 260px;
        background: #222;
        color: white;
        overflow-y: auto;
        padding: 10px;
    }
    .foto-sidebar {
        text-align: center;
        margin-bottom: 15px;
        cursor: pointer;
    }
    .foto-sidebar img {
        width: 100%;
        border-radius: 5px;
        border: 2px solid transparent;
        transition: border 0.2s;
    }
    .foto-sidebar img:hover {
        border: 2px solid yellow;
    }
    .foto-numero {
        font-size: 16px;
        margin-top: 4px;
        font-weight: bold;
    }

    /* Área principal */
    #main {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
    }
    #foto-grande {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    #foto-grande img {
        max-width: 90%;
        max-height: 70vh;
        border-radius: 5px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
    }
    button {
        padding: 8px 16px;
        cursor: pointer;
        background: #007BFF;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 16px;
    }

    /* Miniaturas */
    #miniaturas {
        display: flex;
        gap: 15px;
        margin-top: 15px;
        flex-wrap: wrap;
        justify-content: center;
    }
    .miniatura {
        text-align: center;
        cursor: pointer;
    }
    .miniatura img {
        max-width: 150px;
        border-radius: 5px;
        border: 2px solid transparent;
        transition: border 0.2s;
    }
    .miniatura img:hover {
        border: 2px solid orange;
    }
    .miniatura-nome {
        margin-top: 5px;
        font-size: 14px;
    }
</style>
</head>
<body>

<div id="sidebar">
    <h3>Fotos</h3>
    <div id="lista-fotos"></div>
</div>

<div id="main">
    <div id="foto-grande">
        <h2>Selecione uma foto</h2>
    </div>
    <div id="miniaturas"></div>
</div>

<script>
let grupos = {};
let fotoSelecionada = null;
let variacoesAtuais = [];

// Carrega lista de imagens do servidor
async function carregarImagens() {
    const resp = await fetch("/imagens");
    const lista = await resp.json();

    // Agrupa por número final
    grupos = {};
    lista.forEach(nome => {
        const partes = nome.split("_");
        const num = partes[partes.length - 1].replace(".jpg", "");
        if (!grupos[num]) grupos[num] = [];
        grupos[num].push(nome);
    });

    // Preenche a barra lateral
    const listaDiv = document.getElementById("lista-fotos");
    listaDiv.innerHTML = "";
    for (let num in grupos) {
        const primeira = grupos[num][0];
        const div = document.createElement("div");
        div.className = "foto-sidebar";

        const img = document.createElement("img");
        img.src = "/imagens/" + primeira;
        img.alt = num;
        img.onclick = () => selecionarFoto(num);

        const numeroDiv = document.createElement("div");
        numeroDiv.className = "foto-numero";
        numeroDiv.textContent = num;

        div.appendChild(img);
        div.appendChild(numeroDiv);
        listaDiv.appendChild(div);
    }
}

function selecionarFoto(num) {
    fotoSelecionada = num;
    variacoesAtuais = grupos[num];
    mostrarFotoGrande(variacoesAtuais[0]); // Mostra a primeira por padrão
    mostrarMiniaturas();
}

function mostrarFotoGrande(nome) {
    const fotoDiv = document.getElementById("foto-grande");
    fotoDiv.innerHTML = "";

    const img = document.createElement("img");
    img.src = "/imagens/" + nome;

    const btn = document.createElement("button");
    btn.textContent = "Imprimir " + nome.split("_")[0];
    btn.onclick = () => {
        const w = window.open("/imagens/" + nome);
        w.print();
    };

    fotoDiv.appendChild(img);
    fotoDiv.appendChild(btn);
}

function mostrarMiniaturas() {
    const miniDiv = document.getElementById("miniaturas");
    miniDiv.innerHTML = "";

    variacoesAtuais.forEach(nome => {
        const div = document.createElement("div");
        div.className = "miniatura";

        const img = document.createElement("img");
        img.src = "/imagens/" + nome;
        img.onclick = () => mostrarFotoGrande(nome);

        const nomeDiv = document.createElement("div");
        nomeDiv.className = "miniatura-nome";
        nomeDiv.textContent = nome.split("_")[0];

        div.appendChild(img);
        div.appendChild(nomeDiv);
        miniDiv.appendChild(div);
    });

    // Adiciona identificação da foto (número)
    const identificacao = document.createElement("div");
    identificacao.style.marginTop = "10px";
    identificacao.style.fontSize = "18px";
    identificacao.style.fontWeight = "bold";
    identificacao.textContent = "ID da Foto: " + fotoSelecionada;

    miniDiv.appendChild(identificacao);
}

carregarImagens();
</script>

</body>
</html>
